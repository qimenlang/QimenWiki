#### 交互场景需求分析

- 近场交互

  - 手势近场
  - 手柄近场

- 近场交互优先级

  - 手柄近场>手势近场

- 远场交互

  - 头控远场交互
  - 手柄远场交互
  - 手势远场交互[仅支持手势不支持眼动]
  - 手柄眼动远场交互（选择器、交互器分离）[仅支持眼动不支持手势]
  - 手势眼动远场交互（选择器、交互器分离）[眼动和手势均支持]

- **远场交互优先级：手柄眼动远场>手柄远场>手势眼动远场>手势远场>头控远场**

- **近远场交互最佳候选冲突问题**

  - 手柄近场交互和手柄远场交互，无法同时选中不同交互对象，不存在两个交互同时发生的情况，选中同一对象，近场交互优先；
  - 手势近场交互和手势远场交互，同时选中不同交互对象，两个交互同时发生(设计为类似手柄近远场交互？)，选中同一对象，近场交互优先；
  - 手柄近场交互和手柄眼动交互，同时选中不同交互对象，眼动交互优先，选中相同对象，眼动交互优先；
  - 手势近场交互和手势眼动交互，同时选中不同交互对象，眼动交互优先，选中相同对象，眼动交互优先；
  - 近场交互和远场交互，选中不同窗口中的交互对象；

- 交互切换规则

  |          |         | 手柄         | 手势         | HMD          |
  | -------- | ------- | ------------ | ------------ | ------------ |
  | 近场交互 | 碰撞    | **手柄近场** | **手势近场** | #            |
  | 远场交互 | 射线    | **手柄射线** | **手势射线** | #            |
  | 远场交互 | HMD射线 | 手柄头控射线 | 手势头控射线 | **头控射线** |
  | 远场交互 | 眼动    | **手柄眼动** | **手势眼动** | 头控眼动     |

  - 触发器切换：手柄、手势、HMD 三选一，手柄和手势互斥，手柄优先级高于手势，HMD与手柄手势不互斥；
  - 选择器切换
    - 近场、远场二选一，优先级：远场眼动>近场>远场射线；
    - 远场选择器配置：射线、眼动、HMD三选一，由用户配置；
  - 除手柄手势切换之外，其他切换全部基于配置文件；
  - 选择器优先级：
    - 四种不同检测器设备类型， 优先级：EYE>HAND=GESTURE>HMD
    - 近场远场交互优先级：近场>远场
    - 排列组合共有8种交互器类型，按优先级：眼动近场>眼动远场>手柄（手势）近场>手柄（手势）远场>HMD近场>HMD远场

- 多触发器交互

  - 单选择器单触发器
  - 单选择器双触发器（眼动/HMD + 手柄/手势）
  - 双选择器双触发器

#### **Detector/Invoker框架搭建，实现多交互器对单一交互对象的交互**

- 需求讨论
  - Detector和Invoker拆分为两个component，独立工作，二者均对应一个device；
  - Invoker在创建时保留Detector的引用，建立连接关系，二者为1:1或者2:1的关系；
  - Invoker处理事件，产生event args需要包含两个设备信息：detect device和invoke device，传给应用侧 ；在手柄、手势等交互中，detect device和invoke device实质对应同一个device，在手眼交互中，detect device和invoke device分别对应眼部设备和手部设备；
  - Invoker、detector需要响应设备的连接、断开；
- 框架设计
  - 由于Detector和Invoker必须相互协作，不能单独使用，依然使用一个Component，不做拆分，该Component中有DetectorManager和InvokerManager两个管理器；
  - 为每个window/client端进程，在scene中增加一个scene object，该scene object的eventcaster负责所有选择器、触发器的交互逻辑；
  - DetectorManager注册、管理所有选择器，InvokerManager注册、管理所有触发器，二者是生产者消费者关系，DetectorManager输出{Candidate、Device}；
  - 为支持多触发器对同一candidate的交互，InvokerManager记录每个触发器正在进行的handler，以便双手交互发生时，进行回退；

#### 手势Mesh

- 实现硬件蒙皮，解决cpu功耗过大问题；
- 渲染效果正确使用法线信息

#### 眼手手柄切换

#### 交互相关参数配置

#### 交互相关问题

- 事件之间的关系：一个交互对象可以绑定多个交互事件，多个交互事件相互之间是否有互斥等关系，例如translate事件被触发，则hover应该end或cancel;或者实现二次交互，要求先响应translate事件，translate update过程中可以响应click事件；

- 事件Block的逻辑梳理：双手事件可以打断单手事件，单手事件可以打断Hover事件，


#### Interactor架构

- 实际的工作是同步设备pose信息和轴数据，本身不赞与事件处理
  - 根据一或多个scene object的pose信息，偏移量等，计算得到设备的pose
  - pinch根据两个骨骼的距离是否小于阈值，poke根据骨骼是否与场景物体发生碰撞，更新轴数据

#### TODO

1. 眼手交互BUG
   - 回归测试UISample测试用例
   - Hover事件重构 待讨论
   - CSE Hold/Translate事件推进重新实现
   - 临时 Cursor 替换为Scene Cursor
   - 仅近处可交互

2. 待完善功能
   - 眼动射线检测器、双圆锥检测器通过配置文件配置？
   - 

3. 









