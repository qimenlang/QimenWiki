## 光栅化

1. frustum 视锥体
   - 宽高比 Aspect Ratio = width/height
   - 视界 field-of-view (竖直方向 fovY、水平方向 fovX(不常用 ))
   - 相机到近平面的距离是固定的？
   
2. 将标准立方体映射到屏幕空间

   - 屏幕空间:起始于原点(0，0)的二维平面

     - pixel index:(x,y) 
     - pixel (x,y)  position:(x+0.5,y+0.5)

   - Canonical Cube:[-1,1]^3

     - 通过MVP运算得到的是标准立方体

     - 标准立方体需要转换到屏幕空间，3维转2维，只考虑x,y，不考虑z,z在深度测试中有用

     - from [-1,1]^2 to [0,width]*[0,height]的转换用矩阵表示：
       $$
       M_{viewport} =
       \begin{bmatrix}
       width/2&0&0&width/2\\
       0&height/2&0&height/2\\
       0&0&1&0\\
       0&0&0&1
       \end{bmatrix}
       $$

   

3. 三角形的优势
   - 最基础的多边形，其他多边形都可以拆分成三角形
   - 一定是平面
   - 内外定义清晰，可以利用向量的叉积判断点在三角形内部或者外部
   - 重心坐标方便插值

4. 采样 光栅化就是在屏幕空间用像素中心的点进行的采样

5. 包围盒
   - AABB axis-aligned bounding box

6. 锯齿
   - 产生原因：
     - 像素本身有一定的大小
     - 采样率对不够高
   - 抗锯齿、反走样

7. 反走样 anti-aliasing
   1. 采样理论

   2. 信号处理
      1. 频域 Frequency Domain

      2. 采样速度跟不上信号变化速度就会产生走样

      3. 滤波：把某些特定的频域、频率删掉

         - 傅里叶变换可以将时域信息转换到频域
         - 高通滤波：将低频信息删掉，留下高频信息，高频信息意味着信号变化非常大，在图片中是边界；
         - 低通滤波：删掉高频信息（边界），留下低频，在图片上会产生模糊效果；
         - 带通滤波：留下中间指定频域；

      4. 卷积：对指定位置的数字做周围所有数字的平均\加权平均

         - 时域上对两个信号进行卷积，对应对频域上的两个信号进行乘积

           ![时域卷积=频域乘积](C:\Users\51039\Desktop\500h\games101\Pictures\时域卷积=频域乘积.png)

         - 卷积核（时域上）= 滤波器（频域上）

   3. 反走样理论 ：先做模糊，再做采样 
      1. 在采样之前做模糊、滤波，处于边界的采样点会被插值，以减小采样点的突变
         - 先把高频信息过滤掉（模糊），再进行采样
      2. Blurred Aliasing:先做采样，后对采样点进行模糊，效果差，不可用,其实还是走样的，只不过走样之后又被模糊了 
      3. 为什么Blurred Aliasing 达不到反走样的效果
      
   4.  反走样实践

      - Multi-Sample Antialiasing (MSAA):在原先一个采样点上用更多的采样点进行采样，求采样的平均值；  
      - Fast Approximate AA(FXAA):在图像层面上，找到边界，边界带有锯齿，将带有锯齿的边界换成没有锯齿的边界；
      - Temporal AA(TAA)：用上一帧的边界信息 ，用一个像素上的不同的采样点（MSAA采样点）去检测边界；
      - Deep Learning Super Sampling(DLSS):用深度学习训练模型猜测超采样；

8. Artifacts :一切看起来不对的东西，瑕疵

   - 锯齿
   - 摩尔纹

9. 深度缓冲 解决可视问题

   1.  画家算法要求三角面片之间有明确的深度顺序关系，不能解决循环遮挡的问题；
   2. 深度缓冲 Z-Buffer
      - 缓存了场景中可以看见的像素的深度
      -  便利所有三角形的像素，记录每个像素的最小深度
      - 不记录透明物体的深度，透明物体需要特殊处理
